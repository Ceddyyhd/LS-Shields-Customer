{
  "version": 3,
  "sources": ["../../src/formats/link.ts", "../../src/themes/snow.ts"],
  "sourcesContent": ["import Inline from '../blots/inline.js';\n\nclass Link extends Inline {\n  static blotName = 'link';\n  static tagName = 'A';\n  static SANITIZED_URL = 'about:blank';\n  static PROTOCOL_WHITELIST = ['http', 'https', 'mailto', 'tel', 'sms'];\n\n  static create(value: string) {\n    const node = super.create(value) as HTMLElement;\n    node.setAttribute('href', this.sanitize(value));\n    node.setAttribute('rel', 'noopener noreferrer');\n    node.setAttribute('target', '_blank');\n    return node;\n  }\n\n  static formats(domNode: HTMLElement) {\n    return domNode.getAttribute('href');\n  }\n\n  static sanitize(url: string) {\n    return sanitize(url, this.PROTOCOL_WHITELIST) ? url : this.SANITIZED_URL;\n  }\n\n  format(name: string, value: unknown) {\n    if (name !== this.statics.blotName || !value) {\n      super.format(name, value);\n    } else {\n      // @ts-expect-error\n      this.domNode.setAttribute('href', this.constructor.sanitize(value));\n    }\n  }\n}\n\nfunction sanitize(url: string, protocols: string[]) {\n  const anchor = document.createElement('a');\n  anchor.href = url;\n  const protocol = anchor.href.slice(0, anchor.href.indexOf(':'));\n  return protocols.indexOf(protocol) > -1;\n}\n\nexport { Link as default, sanitize };\n", "import { merge } from 'lodash-es';\nimport Emitter from '../core/emitter.js';\nimport BaseTheme, { BaseTooltip } from './base.js';\nimport LinkBlot from '../formats/link.js';\nimport { Range } from '../core/selection.js';\nimport icons from '../ui/icons.js';\nimport Quill from '../core/quill.js';\nimport type { Context } from '../modules/keyboard.js';\nimport type Toolbar from '../modules/toolbar.js';\nimport type { ToolbarConfig } from '../modules/toolbar.js';\nimport type { ThemeOptions } from '../core/theme.js';\n\nconst TOOLBAR_CONFIG: ToolbarConfig = [\n  [{ header: ['1', '2', '3', false] }],\n  ['bold', 'italic', 'underline', 'link'],\n  [{ list: 'ordered' }, { list: 'bullet' }],\n  ['clean'],\n];\n\nclass SnowTooltip extends BaseTooltip {\n  static TEMPLATE = [\n    '<a class=\"ql-preview\" rel=\"noopener noreferrer\" target=\"_blank\" href=\"about:blank\"></a>',\n    '<input type=\"text\" data-formula=\"e=mc^2\" data-link=\"https://quilljs.com\" data-video=\"Embed URL\">',\n    '<a class=\"ql-action\"></a>',\n    '<a class=\"ql-remove\"></a>',\n  ].join('');\n\n  preview = this.root.querySelector('a.ql-preview');\n\n  listen() {\n    super.listen();\n    // @ts-expect-error Fix me later\n    this.root\n      .querySelector('a.ql-action')\n      .addEventListener('click', (event) => {\n        if (this.root.classList.contains('ql-editing')) {\n          this.save();\n        } else {\n          // @ts-expect-error Fix me later\n          this.edit('link', this.preview.textContent);\n        }\n        event.preventDefault();\n      });\n    // @ts-expect-error Fix me later\n    this.root\n      .querySelector('a.ql-remove')\n      .addEventListener('click', (event) => {\n        if (this.linkRange != null) {\n          const range = this.linkRange;\n          this.restoreFocus();\n          this.quill.formatText(range, 'link', false, Emitter.sources.USER);\n          delete this.linkRange;\n        }\n        event.preventDefault();\n        this.hide();\n      });\n    this.quill.on(\n      Emitter.events.SELECTION_CHANGE,\n      (range, oldRange, source) => {\n        if (range == null) return;\n        if (range.length === 0 && source === Emitter.sources.USER) {\n          const [link, offset] = this.quill.scroll.descendant(\n            LinkBlot,\n            range.index,\n          );\n          if (link != null) {\n            this.linkRange = new Range(range.index - offset, link.length());\n            const preview = LinkBlot.formats(link.domNode);\n            // @ts-expect-error Fix me later\n            this.preview.textContent = preview;\n            // @ts-expect-error Fix me later\n            this.preview.setAttribute('href', preview);\n            this.show();\n            const bounds = this.quill.getBounds(this.linkRange);\n            if (bounds != null) {\n              this.position(bounds);\n            }\n            return;\n          }\n        } else {\n          delete this.linkRange;\n        }\n        this.hide();\n      },\n    );\n  }\n\n  show() {\n    super.show();\n    this.root.removeAttribute('data-mode');\n  }\n}\n\nclass SnowTheme extends BaseTheme {\n  constructor(quill: Quill, options: ThemeOptions) {\n    if (\n      options.modules.toolbar != null &&\n      options.modules.toolbar.container == null\n    ) {\n      options.modules.toolbar.container = TOOLBAR_CONFIG;\n    }\n    super(quill, options);\n    this.quill.container.classList.add('ql-snow');\n  }\n\n  extendToolbar(toolbar: Toolbar) {\n    if (toolbar.container != null) {\n      toolbar.container.classList.add('ql-snow');\n      this.buildButtons(toolbar.container.querySelectorAll('button'), icons);\n      this.buildPickers(toolbar.container.querySelectorAll('select'), icons);\n      // @ts-expect-error\n      this.tooltip = new SnowTooltip(this.quill, this.options.bounds);\n      if (toolbar.container.querySelector('.ql-link')) {\n        this.quill.keyboard.addBinding(\n          { key: 'k', shortKey: true },\n          (_range: Range, context: Context) => {\n            toolbar.handlers.link.call(toolbar, !context.format.link);\n          },\n        );\n      }\n    }\n  }\n}\nSnowTheme.DEFAULTS = merge({}, BaseTheme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        link(value: string) {\n          if (value) {\n            const range = this.quill.getSelection();\n            if (range == null || range.length === 0) return;\n            let preview = this.quill.getText(range);\n            if (\n              /^\\S+@\\S+\\.\\S+$/.test(preview) &&\n              preview.indexOf('mailto:') !== 0\n            ) {\n              preview = `mailto:${preview}`;\n            }\n            // @ts-expect-error\n            const { tooltip } = this.quill.theme;\n            tooltip.edit('link', preview);\n          } else {\n            this.quill.format('link', false, Quill.sources.USER);\n          }\n        },\n      },\n    },\n  },\n} satisfies ThemeOptions);\n\nexport default SnowTheme;\n"],
  "mappings": "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",
  "names": ["Link", "Inline", "create", "value", "node", "setAttribute", "sanitize", "formats", "domNode", "getAttribute", "url", "PROTOCOL_WHITELIST", "SANITIZED_URL", "format", "name", "statics", "blotName", "constructor", "tagName", "protocols", "anchor", "document", "createElement", "href", "protocol", "slice", "indexOf", "TOOLBAR_CONFIG", "header", "list", "SnowTooltip", "BaseTooltip", "preview", "root", "querySelector", "listen", "addEventListener", "event", "classList", "contains", "save", "edit", "textContent", "preventDefault", "linkRange", "range", "restoreFocus", "quill", "formatText", "Emitter", "sources", "USER", "hide", "on", "events", "SELECTION_CHANGE", "oldRange", "source", "length", "link", "offset", "scroll", "descendant", "LinkBlot", "index", "Range", "formats", "domNode", "setAttribute", "show", "bounds", "getBounds", "position", "removeAttribute", "TEMPLATE", "join", "SnowTheme", "BaseTheme", "constructor", "options", "modules", "toolbar", "container", "add", "extendToolbar", "buildButtons", "querySelectorAll", "icons", "buildPickers", "tooltip", "keyboard", "addBinding", "key", "shortKey", "_range", "context", "handlers", "call", "format", "DEFAULTS", "merge", "value", "getSelection", "getText", "test", "indexOf", "theme", "Quill"]
}
